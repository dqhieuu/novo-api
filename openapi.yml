openapi: 3.0.2
info:
  title: Novo App
  version: '1.0'
  description: >-
    A book server that serves all kinds of books (novels, comics, manga and
    whatnots)
  contact: {}
servers:
  - url: 'http://localhost:7001'
paths:
  '/oauth/{provider}':
    get:
      summary: OAuth login initialize
      description: Redirects client to OAuth provider page for 3-legged authentication.
      responses:
        '302':
          description: Redirect to the provider page
        '404':
          description: Provider not found
      tags:
        - Users
      parameters:
        - name: provider
          in: path
          required: true
          description: The provider of the OAuth service.
          schema:
            $ref: '#/components/schemas/OauthProvider'
      operationId: goToOauthProvider
      security: []
      
  /login:
    get:
      summary: OAuth login
      security: []
      description: >
        Client goes to this page after having received the oauth code from
        provider (Google). It's performed automatically.
      parameters:
        - name: provider
          in: query
          required: true
          description: The provider of the OAuth service.
          schema:
            type: string
            enum:
              - google
        - name: code
          in: query
          required: true
          description: >
            Code received after the client has successfully been verified by the OAuth
            provider side. (Embedded in the redirect link)
          schema:
            type: string
      responses:
        '200':
          description: Login success
        '401':
          description: Invalid credentials
        '404':
          description: Provider not found
      tags:
        - Users
      operationId: loginByPassword
    post:
      summary: Password login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [usernameOrEmail, password]
              properties:
                usernameOrEmail:
                  type: string
                  example: Người dùng X
                  minLength: 6
                password:
                  $ref: '#/components/schemas/Password'
      responses:
        '200':
          description: Successful login
        '401':
          description: Invalid credentials
      tags:
        - Users
      parameters: []
      operationId: loginByOAuthCode
  /auth/refresh-token:
    post:
      summary: Refresh user token
      tags:
        - Users
      responses:
        '200':
          description: OK
        '401':
          description: Invalid credentials
  /auth/logout:
    post:
      summary: Logout user
      tags:
        - Users
      responses:
        '200':
          description: OK
        '401':
          description: Invalid credentials
  /auth/book:
    post:
      summary: Create a new book group
      description: Create a new book group by json request body.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: One punch Man
                  description: The name of this book group. Must not contain line break characters and control characters.
                alias:
                  type: string
                  example: Anh hùng saitama; wan-pan
                  description: (New) The aliases of this book group name. Separated by a ';'
                description:
                  type: string
                  description: The book summary. Must not contain control characters.
                  example: The story of a hero named Saitama.
                authors:
                  type: array
                  example: [123, 124, 125]
                  description: Author IDs from the database. Accepts everything, but will only save non duplicates and valid author ids.
                  items: 
                    type: integer
                coverArts:
                  type: array
                  example: [123, 124, 125]
                  description: Image IDs from the database. The last valid one will be selected as the cover thumbnail 
                    if the primaryCoverArt is not set (in case this field has valid values).
                  items: 
                    type: integer
                genres:
                  type: array
                  description: Genre IDs of this book. Accepts everything, but will only save non duplicates and valid ones.
                  example: [2,3,5]
                  items:
                    type: integer
                primaryCoverArt:
                  type: integer
                  example: 1234
                  description: Must be one of the cover arts. No passing will automatically fall back to the last cover art of `coverArts`, if `coverArts` has valid values.
                  items: 
                    type: integer
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                description: The book group id after created
                properties:
                  id:
                    type: integer
                    example: 1231
        403:
          description: User not authorized
      tags: [Book Groups]
  /book/{bookGroupId}:
    get:
      summary: Get book group page content
      description: Create a new book group by json request body. Arrays fields if empty must return an empty array.
      tags:
        - Book Groups
        
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                required:
                  - name
                  - views
                  - likeCount
                  - dislikeCount
                  - authors
                  - genres
                  - chapters
                  - coverArts
                  - ownerId
                properties:
                  name:
                    type: string
                    example: One punch Man
                    description: The name of this book group
                  alias:
                    type: string
                    example: Anh hùng saitama; wan-pan
                    description: (New) The aliases of this book group name. Separated by a ';'
                  description:
                    type: string
                    example: The story of a hero named Saitama.
                  views:
                    example: 1245
                    type: integer
                    description: Number of views from all chapters of this book. Being on this page doesn't count in the total views.
                  likeCount:
                    type: integer
                    example: 3
                  dislikeCount:
                    type: integer
                    example: 0
                  ownerId:
                    type: integer
                    example: 3
                  authors:
                    type: array
                    items:
                      type: object
                      required:
                        - id
                        - name
                      properties:
                        name:
                          type: string
                          example: Nguyễn Nhật Ánh
                        id:
                          type: integer
                          description: Author id
                          example: 1231
                  genres:
                    type: array
                    description: Genre ids and names of this book.
                    items: 
                      type: object
                      required:
                        - id
                        - name
                      properties:
                        id:
                          type: integer
                          example: 1231
                        name:
                          type: string
                          example: Tình cảm
                  chapters:
                    type: array
                    items:
                      type: object
                      required:
                        - chapterNumber
                        - id
                        - timePosted
                        - userPosted
                        - views
                      properties:
                        chapterNumber:
                          type: number
                          example: 12.1
                        name:
                          type: string
                          example: This chapter title or something
                        id:
                          type: integer
                          description: Chapter id
                          example: 1231
                        timePosted:
                          type: integer
                          description: Timestamp when it was posted
                          example: 1612012011
                        views:
                          type: integer
                          description: View count of this chapter
                          example: 2512
                        userPosted:
                          type: object
                          required:
                            - id
                            - name  
                          properties:
                            id:
                              type: integer
                              example: 124
                            name:
                              type: string
                              example: nguyenVanA
                            

                  coverArts:
                    type: array
                    items: 
                      type: object
                      properties:
                        path:
                          type: string
                          example: cover-art/515-133-22.jpg
                        id:
                          type: integer
                          example: cover-art/515-133-22.jpg
                  primaryCoverArt:
                    type: string
                    example: cover-art/515-133-22.jpg
                  primaryCoverArtId:
                    type: integer
                    example: 12

        404:
          description: Book group not found
  /auth/book/{bookGroupId}:
    patch:
      summary: Update a book group
      description: Update a new book group by fields.
      parameters:
        - name: bookGroupId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: One punch Man
                  description: The name of this book group. Must not contain line break characters and control characters.
                alias:
                  type: string
                  example: Anh hùng saitama; wan-pan
                  description: (New) The aliases of this book group name. Separated by a ';'
                description:
                  type: string
                  description: The book summary. Must not contain control characters.
                  example: The story of a hero named Saitama.
                authors:
                  type: array
                  example: [123, 124, 125]
                  description: Author IDs from the database. Accepts everything, but will only save non duplicates and valid author ids.
                  items: 
                    type: integer
                coverArts:
                  type: array
                  example: [123, 124, 125]
                  description: Image IDs from the database. The last valid one will be selected as the cover thumbnail 
                    if the primaryCoverArt is not set (in case this field has valid values).
                  items: 
                    type: integer
                genres:
                  type: array
                  description: Genre IDs of this book. Accepts everything, but will only save non duplicates and valid ones.
                  example: [2,3,5]
                  items:
                    type: integer
                primaryCoverArt:
                  type: integer
                  example: 1234
                  description: Must be one of the cover arts. No passing will automatically fall back to the last cover art of `coverArts`, if `coverArts` has valid values.
                  items: 
                    type: integer
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                description: The book group id after created
                properties:
                  id:
                    type: integer
                    example: 1231
        403:
          description: User not authorized
        409:
          description: Conflict or conditions not met
      tags: [Book Groups]
    delete:
      summary: Delete a book group
      description: Delete a book group by its id. Will delete all containing book chapters.
      parameters:
        - name: bookGroupId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Deleted OK
        403:
          description: User not authorized
        404:
          description: Book group not found
      tags:
        - Book Groups

  /search-suggest/{query}:
    get:
      summary: Search suggestion
      description: Suggestion when typing text in the search box.
      parameters:
        - name: query
          in: path
          required: true
          schema:
            type: string
            example: solo lev
            maxLength: 100
      security: []
      responses:
        '200':
          description: A list of book may contain 0 elements
          content:
            application/json:
              schema:
                type: object
                required:
                  - books
                properties:
                  books:
                    type: array
                    description: A suggestion list of books when searching.
                    items:
                      $ref: '#/components/schemas/BookItem'
      tags:
        - Book Groups
      operationId: searchSuggestion
  /search/{query}:
    get:
      summary: Search result
      description: Result page containing book groups after hitting enter.
      parameters:
        - name: query
          in: path
          required: true
          schema:
            type: string
            example: solo leveling
        - name: page
          $ref: '#/components/parameters/Page'
      operationId: getSearchResult
      security: []
      responses:
        200:
          description: Query success
          content:
            application/json:
              schema:
                type: object
                required:
                  - books
                  - lastPage
                properties:
                  lastPage:
                    $ref: '#/components/schemas/LastPage'
                  books:
                    type: array
                    description: Books in a dedicated search page
                       have more information than when searching.
                    items:
                      $ref: '#/components/schemas/BookItemFull'

      tags:
        - Book Groups
  '/book/top/{type}':
    get:
      summary: Get top viewed book groups
      description: Get top viewed book groups by month/week/year/all.
      parameters:
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum:
              - week
              - month
              - year
              - all
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 10
            maximum: 100
        - name: page
          in: query
          schema:
            type: integer
            default: 1
      security: []
      responses:
        200:
          description: Query success
          content:
            application/json:
              schema:
                type: object
                required:
                  - books
                  - lastPage
                properties:
                  lastPage:
                    $ref: '#/components/schemas/LastPage'
                  books:
                    type: array
                    description: Books in a dedicated search page
                       have more information than when searching.
                    items:
                      $ref: '#/components/schemas/BookItemFull'
      tags:
        - Book Groups
  '/book/random':
    get:
      summary: Get random book groups
      description: Get n random book groups.
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 10
            maximum: 100
      security: []
      responses:
        200:
          description: Query success
          content:
            application/json:
              schema:
                type: object
                required:
                  - books
                properties:
                  books:
                    type: array
                    description: Books in a dedicated search page
                       have more information than when searching.
                    items:
                      $ref: '#/components/schemas/BookItemFull'
      tags:
        - Book Groups
  '/book/latest':
    get:
      summary: Get most recent book groups
      description: Get most recent book groups ordered by newly added chapter
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 10
            maximum: 100
        - name: page
          in: query
          schema:
            type: integer
            default: 1
      security: []
      responses:
        200:
          description: Query success
          content:
            application/json:
              schema:
                type: object
                required:
                  - books
                  - lastPage
                properties:
                  lastPage:
                    $ref: '#/components/schemas/LastPage'
                  books:
                    type: array
                    description: Books in a dedicated search page
                       have more information than when searching.
                    items:
                      $ref: '#/components/schemas/BookItemFull'
      tags:
        - Book Groups
  '/chapter/{chapterId}':
    get:
      summary: Get chapter page content
      description: |-
        All necessary content for displaying a chapter page.
        There are links to the previous and next chapter
      parameters:
        - name: chapterId
          in: path
          required: true
          schema:
            type: string
          description: Id of a chapter from the database
      operationId: getChapterByChapterId
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    required:
                      - type
                      - chapterNumber
                      - images
                      - bookGroupId
                    properties:
                      type:
                        type: string
                        example: images
                        enum:
                          - images
                      bookGroupId: 
                        type: integer
                        example: 125
                      chapterNumber: 
                        type: integer
                        example: 123
                      name:
                        type: string
                        example: A story of rain
                      images:
                        type: array
                        description: A list of images
                        items: 
                          type: object
                          required:
                            - path
                            - id
                          properties:
                            path:
                              type: string
                              example: cover-art/515-133-22.jpg
                            id:
                              type: integer
                              example: cover-art/515-133-22.jpg
                  - type: object
                    required:
                      - type
                      - chapterNumber
                      - textContent
                      - bookGroupId
                    properties:
                      type:
                        type: string
                        example: hypertext
                        enum:
                          - hypertext
                      bookGroupId: 
                        type: integer
                        example: 125
                      chapterNumber: 
                        type: integer
                        example: 123.3
                      name:
                        type: string
                        example: A story of rain
                      textContent:
                        type: string
                        example: Call me Ishmael. Some years ago...
                        description: The content for a text chapter (may contain markdown formattting)

        404:
          description: Chapter not found
      security: []
      tags:
        - Book Chapters
  /auth/chapter/images:
    post:
      summary: Post a new chapter (images type)
      description: A new `images` type book chapter to be posted, must belong to a book group.
      parameters: []
      operationId: postNewChapterImages
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                description: The chapter id after created
                properties:
                  id:
                    type: integer
                    example: 1231
      requestBody:
        required: true
        content:
          application/json:
            schema:
                type: object
                required:
                  - bookGroupId
                  - chapterNumber
                  - images
                properties:
                  bookGroupId:
                    type: integer
                    example: 25
                  name:
                    type: string
                    example: A story of rain
                    maxLength: 50
                  chapterNumber:
                    type: number
                    example: 6.8
                  images:
                    description: IDs of images after uploaded to the server. Order matters!
                    type: array
                    items:
                      type: integer
      tags:
        - Book Chapters
  /auth/chapter/images/{chapterId}:
    patch:
      summary: Update an images chapter
      description: Update fields of `images` chapter.
      parameters:
        - name: chapterId
          in: path
          schema:
            type: number
          required: true
      responses:
        200:
          description: OK
      tags:
        - Book Chapters
      requestBody:
        required: true
        content:
          application/json:
            schema:
                type: object
                properties:
                  name:
                    type: string
                    example: A story of rain
                  chapterNumber:
                    type: number
                    example: 6.8
                  images:
                    example: [15,16,18]
                    description: IDs of images after uploaded to the server. Order matters!
                    type: array
                    items:
                      type: integer
  /auth/chapter/hypertext:
    post:
      summary: Post a new chapter (hypertext type)
      description: A new `hypertext` type book chapter to be posted, must belong to a book group.
      parameters: []
      operationId: postNewChapterHypertext
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                description: The chapter id after created
                properties:
                  id:
                    type: integer
                    example: 1231
      requestBody:
        required: true
        content:
          application/json:
            schema:
                type: object
                required:
                  - bookGroupId
                  - chapterNumber
                  - textContent
                properties:
                  bookGroupId:
                    type: integer
                    example: 25
                  name:
                    type: string
                    example: A story of rain
                  chapterNumber:
                    type: number
                    example: 6.8
                  textContent:
                    description: The hypertext content of the chapter.
                    type: string
                    example: "Some book content. Once upon..."
      tags:
        - Book Chapters
  /auth/chapter/hypertext/{chapterId}:
    patch:
      summary: Update a hypertext chapter
      description: Update fields of `hypertext` chapter.
      parameters:
        - name: chapterId
          in: path
          schema:
            type: number
          required: true
      responses:
        200:
          description: OK
      tags:
        - Book Chapters
      requestBody:
        required: true
        content:
          application/json:
            schema:
                type: object
                properties:
                  name:
                    type: string
                    example: A story of rain
                  chapterNumber:
                    type: number
                    example: 6.8
                  textContent:
                    description: The hypertext content of the chapter.
                    type: string
                    example: "Some book content. Once upon..."
  /auth/chapter/{chapterId}:
    delete:
      summary: Delete a book chapter
      description: ''
      parameters:
        - name: chapterId
          in: path
          schema:
            type: number
          required: true
      operationId: deleteChapterByChapterId
      responses:
        '200':
          description: Deleted successfully
        '403':
          description: User not authorized
        '404':
          description: Book chapter not found
      tags:
        - Book Chapters
                
  # '/like/{bookGroupId}':
  #   get:
  #     summary: Get like count of a book group
  #     description: This gets the like and dislike count of a book group
  #     parameters:
  #       - name: bookGroupId
  #         in: path
  #         required: true
  #         schema:
  #           type: integer
  #     security: []
  #     operationId: getLikeAndDislikeCountByBookGroupId
  #     responses:
  #       200:
  #         description: Successful get
  #         content:
  #           application/json:
  #             schema:
  #               type: object
  #               required:
  #                 - likeCount
  #                 - dislikeCount
  #               properties:
  #                 likeCount:
  #                   type: integer
  #                   example: 3
  #                 dislikeCount:
  #                   type: integer
  #                   example: 0
  #       404:
  #         description: Book group not found


  #     tags:
  #       - Book Groups
  /auth/like/{bookGroupId}/{operation}:
    post:
      summary: Like operations on a book group
      description: Like/dislike/or unlike operation by a user for a book group
      parameters:
        - name: bookGroupId
          in: path
          required: true
          schema:
            type: integer
        - name: operation
          in: path
          required: true
          schema:
            enum: [like, dislike, unlike]
            example: like
            type: string
      operationId: likeOperationsForBookGroup
      responses:
        200:
          description: OK
        403:
          description: User not authorized
        404:
          description: Book group not found
      tags:
        - Book Groups
  /comment:
    get:
      summary: Get comments from a book group/chapter
      description: >-
        Contains all comments from chapters in this group and comments not in any chapter (book-group scope comments)
      parameters:
        - $ref: '#/components/parameters/BookGroupId'
        - $ref: '#/components/parameters/BookChapterId'
        - $ref: '#/components/parameters/Page'
      operationId: getCommentsByBookGroupOrChapterId
      security: []
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                required:
                  - comments
                  - lastPage
                properties:
                  lastPage:
                    $ref: '#/components/schemas/LastPage'
                  comments:
                    type: array
                    items:
                      type: object
                      required:
                        - comment
                        - userName
                        - userId
                        - timePosted
                        - commentId
                      properties:
                        comment:
                          description: Content of a comment
                          type: string
                          example: Bình luận gì đó...
                        userName:
                          type: string
                          example: Tên ng dùng ABCD
                        commentId:
                          type: integer
                          example: 1232
                        userId:
                          type: integer
                          example: 1231
                        userAvatar:
                          type: string
                          description: Url of user's avatar
                          example: user-avatar/2a82c91-12c-132131aba30.jpg
                        timePosted:
                          description: Timestamp of comment when created
                          type: integer
                          example: 1231111111
                        chapterId:
                          description: Chapter ID where this user commented (if available)
                          type: integer
                          example: 12341
                        chapterNumber:
                          description: Chapter number where this user commented (if available)
                          type: number
                          example: 4.3 
        404:
          description: Book group/chapter not found
      tags:
        - Book Comments
  /comment/latest:
    get:
      summary: Get latest comments
      description: >-
        Get latest comments regardless of book group/book chapter
      operationId: getLatestComments
      security: []
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  required:
                    - comment
                    - userName
                    - userId
                    - timePosted
                    - commentId
                    - book
                    - bookName
                    - bookId
                  properties:
                    comment:
                      description: Content of a comment
                      type: string
                      example: Bình luận gì đó...
                    userName:
                      type: string
                      example: Tên ng dùng ABCD
                    commentId:
                      type: integer
                      example: 1232
                    userId:
                      type: integer
                      example: 1231
                    userAvatar:
                      type: string
                      description: Url of user's avatar
                      example: user-avatar/2a82c91-12c-132131aba30.jpg
                    timePosted:
                      description: Timestamp of comment when created
                      type: integer
                      example: 1231111111
                    bookName:
                      description: Book name where this user commented 
                      type: integer
                      example: 12341
                    bookId:
                      description: Book id where this user commented
                      type: number
                      example: 4.3
                    chapterId:
                      description: Chapter ID where this user commented (if available)
                      type: integer
                      example: 12341
                    chapterNumber:
                      description: Chapter number where this user commented (if available)
                      type: number
                      example: 4.3 
                    chapterName: 
                      type: string
                      example: Chapter name
      tags:
        - Book Comments
  /auth/comment:
    post:
      summary: Post a comment in a book group/chapter
      description: Create a comment that isn't chapter specific
      parameters:
        - name: bookGroupId
          in: query
          required: true
          schema:
            type: integer
        - $ref: '#/components/parameters/BookChapterId'
      operationId: postCommentByBookGroupId
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - comment
              properties:
                comment:
                  type: string
                  description: The content of the comment to be posted. Contains no more than 2 consecutive line breaks
                  example: Test thử comment cái
                  minLength: 10
                  maxLength: 500
      responses:
        '200':
          description: Posted successfully
        '403':
          description: User not authorized
        '404':
          description: Book group/chapter not found
      tags:
        - Book Comments
  /auth/comment/${commentId}:
    delete:
      summary: Delete a book comment
      description: Delete a comment by its id
      parameters:
        - name: commentId
          in: path
          required: true
          schema:
            type: integer
      operationId: deleteCommentById
      responses:
        '200':
          description: Deleted successfully
        '403':
          description: User not authorized
        '404':
          description: Could't find comment
      tags:
        - Book Comments
    patch:
      summary: Update a book comment
      description: Update a comment by its id
      parameters:
        - name: commentId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - comment
              properties:
                comment:
                  type: string
                  description: The modified comment content. 
                  example: Cập nhật comment
      operationId: updateCommentById
      responses:
        '200':
          description: Updated successfully
        '403':
          description: User not authorized
        '404':
          description: Could't find comment
      tags:
        - Book Comments
  /register:
    post:
      summary: Register a new user (password)
      description: Register a new user with password, username, and email. An alternative workflow 
        is that user signs up/logs in with their account from an OAuth provider.
      parameters: []
      operationId: registerANewUser
      security: []
      responses:
        200:
          description: Created successfully
        422:
          description: Invalid user data
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  description: Must be at least 6 characters, not starting with a space, may contain at most 1 white space between characters, may contain special characters except control characters and line break characters
                  example: Người dùng W1B00 ／人 ◕ ‿‿ ◕ 人＼
                email:
                  type: string
                  example: example@example.com
                  description: Standards compliant
                password:
                  type: string
                  description: Must be at least 8 characters
                  example: A!B2Ce%%
              required: [username, email, password]
      tags:
        - Users
  /auth/complete-oauth-register:
    post:
      summary: Complete OAuth registration
      description:
        User types in their username and maybe changes their default profile picture
        to complete registration
      parameters: []
      operationId: completeOauthRegister
      responses:
        200:
          description: OAuth user account officially created
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
              properties:
                username:
                  $ref: '#/components/schemas/Username'
                avatar:
                  type: integer
                  description: An image id from the database
      tags:
        - Users
  /search-user/{query}:
    get:
      summary: Search for an user
      description: User suggestion when typing text.
      parameters:
        - name: query
          in: path
          required: true
          schema:
            type: string
            example: nguyen v
            maxLength: 100
      security: []
      responses:
        '200':
          description: Shows maximum 5 users
          content:
            application/json:
              schema:
                type: array
                description: A suggestion list of users when searching.
                example: [{id: 5, name: Nguyễn Văn A, image: user-avatar/123dsad23f1.jpg}]
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  image:
                    type: string
      tags:
        - Users
  /user/{userId}:
    get:
      summary: Get public user info page
      description: Get public user info to be displayed in user page (i.e., username, books posted, profile, avatar )
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      security: []
      operationId: getUserInfoById
      responses:
        200:
          description: Found user
          content:
            application/json:
              schema:
                type: object
                required:
                  - name
                  - role
                  - booksPosted
                properties:
                  name:
                    type: string
                    example: Người dùng ABC
                  role:
                    $ref: '#/components/schemas/UserRole'
                  avatar:
                    type: string
                    description: Url of avatar
                    example: /avatar/2a82c91-12c-132131aba30.jpg
                  avatarId:
                    type: integer
                    description: Avatar image id in database, may be null
                    example: 15
                  description:
                    type: string
                    example: Mô tả người dùng...
                  booksPosted:
                    type: array
                    items:
                      $ref: '#/components/schemas/BookItemFull'
      tags:
        - Users
  /auth/change-password:
    patch:
      summary: Change current user password
      description: Change user password, if a user has input their old password correctly
      operationId: changeUserPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - oldPassword
                - newPassword
              properties:
                oldPassword:
                  type: string
                  description: The old password
                newPassword:
                  type: string
                  description: A new password
      responses:
        200:
          description: OK
        403:
          description: Wrong password/ Changed to invalid password
      tags:
        - Users
  /auth/change-user-info:
    patch:
      summary: Change current user info
      description: Change user info
      operationId: changeUserInfo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  description: A new email
                username:
                  type: string
                  description: A new username
                description:
                  type: string
                  description: A new user description
                avatar:
                  type: integer
                  description: An image id from the database
      responses:
        200:
          description: OK
        403:
          description: Conflicting data/Invalid data
      tags:
        - Users


  /auth/role:
    get:
      summary: Get my role info
      description: Get role permissions, user info required for displaying user.
      parameters: []
      operationId: getMyRolePermissions
      responses:
        200:
          description: Role list
          content:
            application/json:
              schema:
                type: object
                required:
                  - role
                  - permissions
                  - id
                  - name
                  - avatar
                properties:
                  role:
                    $ref: '#/components/schemas/UserRole'
                  permissions:
                    $ref: '#/components/schemas/RolePermissions'
                  id:
                    type: integer
                    example: 1231
                  name:
                    type: string
                    example: Hunter X
                  avatar:
                    type: string
                    example: user-avatar/2a82c91-12c-132131aba30.jpg
                  email:
                    type: string
                    example: hieu@edu.vnu.us
      tags:
        - Users
    patch:
      summary: Set user role (admin only)
      description: Admin sets (modifies) the role of a specific user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - role
              properties:
                userId:
                  type: integer
                  example: 1231
                role:
                  type: string
                  description: Can only set to member, moderator, or banned.
                  enum: [member, moderator, banned]
                  example: member
      operationId: setRole
      responses:
        200:
          description: Role list
      tags:
        - Users
  /auth/author:
    post:
      summary: Create a new author
      description: 'A complete author page, with books from author'
      parameters: []
      operationId: createAuthor
      responses:
        200:
          description: Created successfully
          content:
            application/json:
              schema:
                type: object
                description: The author id after inserting from the database
                properties:
                  id:
                    type: integer
                    example: 1231

        403:
          description: User not authorized
        409:
          description: Author already exists
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  maxLength: 30
                  example: Aldous Huxley
                alias:
                  type: string
                  example: Adolf Hitler;Test Abc
                  description: (New) The aliases of this author name. Separated by a ';'
                description:
                  type: string
                  maxLength: 500
                  example: Something about his biography.
                avatarId:
                  description: The image id in the database
                  type: integer
                  example: 10533
                  
      tags:
        - Book Authors
  /author/{authorId}:
    get:
      summary: Get an author page
      description: 'A complete author page, with books from author'
      parameters:
        - name: authorId
          in: path
          required: true
          schema:
            type: integer
      operationId: getAuthorById
      security: []
      responses:
        200:
          description: Successful request
          content:
            application/json:
              schema:
                type: object
                required:
                  - name
                properties:
                  name:
                    type: string
                    example: George R.R. Washington
                  alias:
                    type: string
                    example: Adolf Hitler;Test Abc
                    description: (New) The aliases of this author name. Separated by a ';'
                  description:
                    type: string
                    example: A novelist who wrote the script for the famous movie, The Ring.
                  avatar:
                    type: string
                    example: image/author-avatar/123124.jpg
                    description: The url of his avatar. Large-sized.
                  avatarId:
                    type: integer
                    example: 25
                  books:
                    type: array
                    items:
                      $ref: '#/components/schemas/BookItemFull'

        403:
          description: User not authorized
        404:
          description: Author not found

      tags:
        - Book Authors
  /search-author/{query}:
    get:
      summary: Search for an author
      description: Author suggestion when typing text.
      parameters:
        - name: query
          in: path
          required: true
          schema:
            type: string
            example: nguyen v
            maxLength: 100
      security: []
      responses:
        '200':
          description: Shows maximum 5 authors
          content:
            application/json:
              schema:
                type: array
                description: A suggestion list of authors when searching.
                example: [{id: 5, name: Nguyễn Văn A, image: author-avatar/123dsad23f1.jpg}]
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  image:
                    type: string
      tags:
        - Book Authors
  /auth/author/{authorId}:
    patch:
      summary: Update an author
      description: 'Update author biography, name, aliases'
      parameters:
        - name: authorId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: New author name
                alias:
                  type: string
                  example: Adolf Hitler;Test Abc
                  description: (New) The aliases of this author name. Separated by a ';'
                description:
                  type: string
                  example: Some modified author description.
                avatar:
                  type: integer
                  description: The image id in the database.
      operationId: updateAuthorById
      responses:
        200:
          description: Updated successfully
        403:
          description: User not authorized
        404:
          description: Author not found
        409:
          description: Conflict when updating author
      tags:
        - Book Authors
    delete:
      summary: Delete an author
      description: Delete an author by id
      parameters:
        - name: authorId
          in: path
          required: true
          schema:
            type: integer

      operationId: deleteAuthorById
      responses:
        200:
          description: Deleted successfully
        403:
          description: User not authorized
        404:
          description: Author not found
        
      tags:
        - Book Authors
  /auth/upload/{imageCategory}:
    post:
      summary: Upload a new image from file
      description: Upload a new image, can be a user avatar / author avatar / chapter image content / cover art
      parameters:
        - name: imageCategory
          in: path
          required: true
          schema:
            type: string
            enum:
              - chapter-image
              - user-avatar
              - author-avatar
              - genre-image
              - cover-art
      operationId: uploadImage
      responses:
        200:
          description: Uploaded successfully
          content:
            application/json:
              schema:
                type: object
                description: The image id from the database
                properties:
                  id:
                    type: integer
                    example: 1231
                  path:
                    type: string
                    example: user-avatar/fa12312f1-1f1-23ab.jpg
        403:
          description: User not authorized
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              
      tags:
        - Images
  /image/{path}:
    get:
      summary: Get image from server
      description: Get image from server disk, with given location. (technically, `/image/{path}` should point to `/static/images/{path}` in disk)
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
            example: cover-art/9b1deb4d-3b7d-4bad-9bdd-2b0d7b3dcb6d.jpg
      operationId: getImage
      security: []
      responses:
        200:
          description: OK
          content:
            image:
              schema:
                type: string
                format: binary
        404:
          description: Image not found
      tags:
        - Images
  /genre/all:
    get:
      summary: Get genre list from server
      description: List all possible book genres
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: string
                      example: Lãng mạn
                    id:
                      type: integer
                      example: 5
      security: []
      tags:
       - Book Genres
  /genre/{genreId}:
    get:
      summary: Get book list by genre 
      description: List books from a genre with pagination
      parameters:
        - name: genreId
          in: path
          required: true
          schema:
            type: string
            example: 12
        - name: page
          $ref: '#/components/parameters/Page'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                required:
                  - books
                  - lastPage
                properties:
                  lastPage:
                    $ref: '#/components/schemas/LastPage'
                  books:
                    type: array
                    description: Books in a dedicated search page
                       have more information than when searching.
                    items:
                      $ref: '#/components/schemas/BookItemFull'
        404:
          description: Genre not found
      tags:
       - Book Genres
      security: []
      
tags:
  - name: Users
    description: For all user related operations.
  - name: Book Groups
    description: Representing folders for book chapters (can also be called book titles).
  - name: Book Chapters
    description: May hold hypertext content or images
  - name: Book Comments
    description: User comments on book groups or book chapters
  - name: Book Authors
    description: People who write books (one book may have multiple authors)
  - name: Book Genres
    description: Function for inserting, finding books group by genres.
  - name: Images 
    description: Functions for uploading, querying image

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: jwt
  links: {}
  callbacks: {}
  parameters:
    Page:
      name: page
      in: query
      required: false
      schema:
        type: integer
        default: 1
      description: May clamp to first/last page for better ux (page <= 0, page = 9999)
    BookGroupId:
      name: bookGroupId
      in: query
      description: If included, ``bookChapterId`` is not required.

      schema:
        type: integer
    BookChapterId:
      name: bookChapterId
      in: query
      description: If included, ``bookGroupId`` is not required.
      schema:
        type: integer
  schemas:
    OauthProvider:
      type: string
      enum:
        - google
    Username:
      type: string
      minLength: 6
      maxLength: 20
      example: Ngdùng W1Bu ／人 ◕ ‿‿ ◕ 人＼
    Password:
      type: string
      minLength: 8
      maxLength: 50
      example: t3stPAS!dảk
    UserRole:
      type: string
      example: member
      enum: [oauth_incomplete, member, moderator, admin]
    RolePermissions:
      type: array
      example: [comment.read, author.read]
      description: Front-end should implement view display strategy according to these enums.
      enum: [comment.read, comment.post, comment.modify, 
        comment.modifySelf, comment.deleteSelf, comment.delete,
        book.read, book.post, book.modifySelf, 
        book.modify, book.deleteSelf, book.delete,
        chapter.read, chapter.post, chapter.modifySelf, 
        chapter.modify, chapter.deleteSelf, chapter.delete,
        author.read, author.post, author.modify, author.delete,
        user.readSelf, user.read, userPrivate.read,
        ]
    BookItem:
      type: object
      required:
        - title
        - id
      properties:
        title:
          type: string
          example: TLOTR
        id:
          type: integer
          description: The id of the book
          example: 12311
        image:
          description:  Image url (primary cover art)
          type: string
          example: cover-art/25-232321-1231.jpg
        latestChapter:
          type: number
          example: 16.5
    LastPage:
      type: integer
      description: The last page number for pagination purposes
      example: 15
    BookItemFull:
      type: object
      required:
        - id
        - title
        - comments
        - views
        - likes
      properties:
        id:
          type: integer
          description: Book group id
          example: 1231
        image:
          description: Image url (primary cover art)
          type: string
          example: cover-art/123faf3-12bcd1-4.jpg
        title:
          type: string
          example: Boku no pico
        latestChapter:
          type: number
          example: 16.5
        lastUpdated:
          description: Timestamp when it was last updated
          type: number
          example: 1602110001
        comments:
          description: Number of comments
          type: integer
          example: 105
        views:
          description: Number of views
          type: integer
          example: 15324
        likes:
          description: The result of likes minus dislikes.
          type: integer
          example: 24


security:
  - cookieAuth: []